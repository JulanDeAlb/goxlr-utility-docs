"use strict";(self.webpackChunkgoxlr_utiltiy_docs=self.webpackChunkgoxlr_utiltiy_docs||[]).push([[4366],{4137:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},h="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),h=c(n),d=i,m=h["".concat(l,".").concat(d)]||h[d]||u[d]||o;return n?a.createElement(m,r(r({ref:t},p),{},{components:n})):a.createElement(m,r({ref:t},p))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[h]="string"==typeof e?e:i,r[1]=s;for(var c=2;c<o;c++)r[c]=n[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},5437:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var a=n(7462),i=(n(7294),n(4137));const o={id:"websocket",title:"Websocket Request",sidebar_position:4},r="Websocket Request",s={unversionedId:"development/api/websocket",id:"development/api/websocket",title:"Websocket Request",description:"Websockets behave slightly differently than simple requests due to extra async behaviors to consider.",source:"@site/docs/development/api/websocket.md",sourceDirName:"development/api",slug:"/development/api/websocket",permalink:"/goxlr-utility-docs/docs/development/api/websocket",draft:!1,editUrl:"https://goxlr-on-linux.github.io/goxlr-utility-docs/docs/development/api/websocket.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{id:"websocket",title:"Websocket Request",sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Simple HTTP Request",permalink:"/goxlr-utility-docs/docs/development/api/simple-http"},next:{title:"Messaging",permalink:"/goxlr-utility-docs/docs/development/api/messaging"}},l={},c=[{value:"JSON Patching",id:"json-patching",level:2},{value:"A Patching Warning...",id:"a-patching-warning",level:3}],p={toc:c},h="wrapper";function u(e){let{components:t,...n}=e;return(0,i.kt)(h,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"websocket-request"},"Websocket Request"),(0,i.kt)("p",null,"Websockets behave slightly differently than simple requests due to extra async behaviors to consider.\nThe websocket supports asynchronous reuse, allowing you to send commands with potentially different execution lengths,\nand get the response as soon as it's available (Note that all requests will be processed in the order received).\nThe main issue that this can cause is that the responses may not arrive in the order they are sent,\nso an ID is required to be attached to all requests, which will be returned with the response."),(0,i.kt)("p",null,"So an example GetStatus request will look something like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "id": 72, /* id is an unsigned 64bit integer */\n    "data": "GetStatus",\n}\n')),(0,i.kt)("p",null,"And responses will follow a similar format:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "id": 72, /* Matches the Request */\n  "data": { "Status" {..} }\n}\n')),(0,i.kt)("p",null,"How to match up requests and responses is an exercise for the integrator, I use simple javascript promises in the Web UI."),(0,i.kt)("h2",{id:"json-patching"},"JSON Patching"),(0,i.kt)("p",null,"Whenever anything about the GoXLR changes (be it a physical interaction,\nor another app changing a setting), a ",(0,i.kt)("a",{parentName:"p",href:"https://jsonpatch.com/"},"JSON Patch")," message is emitted to any and all clients connected via websockets."),(0,i.kt)("p",null,"This patch is intended to be applied to a ",(0,i.kt)("inlineCode",{parentName:"p"},"Status")," object received from executing a ",(0,i.kt)("inlineCode",{parentName:"p"},"GetStatus")," message,\nalthough how this is achieved may be dependent on your platform or language, some options include:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Directly mutating the Status structure (",(0,i.kt)("inlineCode",{parentName:"li"},"fast-json-patch")," for javascript, possibly Reflection in type-safe languages)"),(0,i.kt)("li",{parentName:"ul"},"Storing the raw JSON response from ",(0,i.kt)("inlineCode",{parentName:"li"},"GetStatus"),", patching that, and replacing any de-serialized objects"),(0,i.kt)("li",{parentName:"ul"},"Serialize an object back to JSON, patch the JSON, then de-serialize replacing the original object")),(0,i.kt)("p",null,"For a rust example on handling the websocket and patches, check out ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/FrostyCoolSlug/goxlr-obs-fader-sync/"},"this project"),",\nit fetches the websocket address from the unix socket, grabs the ",(0,i.kt)("inlineCode",{parentName:"p"},"Status"),", patches whenever updates arrive,\nand updates an audio source in OBS whenever a specific channel volume changes (either via fader, or the UI),\nit could be the basis for a 'VOD Track' implementation."),(0,i.kt)("h3",{id:"a-patching-warning"},"A Patching Warning..."),(0,i.kt)("p",null,"When working in a UI, you'll need to be considerate of patch events for your own changes.\nWhen sending a change to the daemon, in addition to the general 'Ok' response, it will emit\na 'Patch' event for that change, confirming it has been made. Depending on the type of interaction,\nand the speed of updates, the patches may be slightly behind what has been sent\n(an example is spamming a slider up and down really fast), and if you've mapped your component directly\nto the ",(0,i.kt)("inlineCode",{parentName:"p"},"Status")," value there might be some contention over the actual value."),(0,i.kt)("p",null,"In addition, if you're modifying the volume of a fader on the full sized GoXLR,\nthe GoXLR itself will trigger internal events for the volume changes to the fader as the motorized sliders move,\nwhich the daemon will pick up and emit as a new patch\n(unfortunately, the GoXLR itself is authoritative as far asvolumes are concerned, and being physical may overshoot\n/ undershoot an intended target making it difficult to handle daemon-side),\nsending a command to the Daemon which sets the volume from 0 to 255 could result in many patch events as the fader moves."),(0,i.kt)("p",null,"In the WebUI, this is solved by temporarily ignoring patch events for sliders while the user is actively manipulating them.\nOnce the user finishes, simply replace the value in the ",(0,i.kt)("inlineCode",{parentName:"p"},"Status")," object with the new value,\nwhich will ostensibly be the same value as the last change sent to the Daemon.\nWhile this might not perfectly catch overshoot / undershoot, and could leave the ",(0,i.kt)("inlineCode",{parentName:"p"},"Status")," object slightly desynced,\nit's generally close enough."))}u.isMDXComponent=!0}}]);